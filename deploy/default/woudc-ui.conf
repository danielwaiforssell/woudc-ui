# apache2 configuration for https://woudc.org

# provide an alias for the Web Accessible Folder (WAF) archive
# so as not to interfere with the application deployment
Alias /archive /data/web/woudc.org/archive

DocumentRoot /data/web/woudc.org/htdocs

<IfModule mod_headers.c>
  Header set X-Content-Type-Options nosniff
  Header set X-Frame-Options DENY
</IfModule>


# permanently redirect legacy pages
<IfModule mod_alias.c>
  Redirect 301 /en TODO
  Redirect 301 /en TODO
  Redirect 301 /fr TODO

  Redirect 301 /en/data/explore TODO
  Redirect 301 /en/data/explore TODO
  Redirect 301 /fr/data/explore TODO

  Redirect 301 /en/data/products TODO
  Redirect 301 /en/data/products?lang=en TODO
  Redirect 301 /fr/data/products?lang=fr TODO

  Redirect 301 /en/data/info.php TODO
  Redirect 301 /en/data/info.php?lang=en TODO
  Redirect 301 /fr/data/info.php?lang=fr TODO

  Redirect 301 /en/data/stations TODO
  Redirect 301 /en/data/stations?lang=en TODO
  Redirect 301 /data/stations?lang=fr TODO

  Redirect 301 /en/data/instruments TODO
  Redirect 301 /en/data/instruments?lang=en TODO
  Redirect 301 /data/instruments?lang=fr TODO

  Redirect 301 /en/contributors/registration.php TODO
  Redirect 301 /en/contributors/registration.php?lang=en TODO
  Redirect 301 /contributors/registration.php?lang=fr TODO

  Redirect 301 /en/contributors TODO
  Redirect 301 /en/contributors?lang=en TODO
  Redirect 301 /contributors?lang=fr TODO

  Redirect 301 /en/contributors/data-submission.php TODO
  Redirect 301 /en/contributors/data-submission.php?lang=en TODO
  Redirect 301 /contributors/data-submission.php?lang=fr TODO

  Redirect 301 /en/resources/sop.php TODO
  Redirect 301 /resources/sop.php?lang=en TODO
  Redirect 301 /resources/sop.php?lang=fr TODO

  Redirect 301 /en/resources/working-groups.php TODO
  Redirect 301 /en/resources/working-groups.php?lang=en TODO
  Redirect 301 /resources/working-groups.php?lang=fr TODO

  Redirect 301 /en/resources/links.php TODO
  Redirect 301 /en/resources/links.php?lang=en TODO
  Redirect 301 /resources/links.php?lang=fr TODO

  Redirect 301 /en/about TODO
  Redirect 301 /en/about?lang=en TODO
  Redirect 301 /about?lang=fr TODO

  Redirect 301 /en/about/index.php TODO
  Redirect 301 /en/about/index.php?lang=en TODO
  Redirect 301 /about/index.php?lang=fr TODO

  Redirect 301 /en/about/data-quality.php TODO
  Redirect 301 /en/about/data-quality.php?lang=en TODO
  Redirect 301 /about/data-quality.php?lang=fr TODO

  Redirect 301 /en/about/data-policy.php TODO
  Redirect 301 /en/about/data-policy.php?lang=en TODO
  Redirect 301 /about/data-policy.php?lang=fr TODO

  Redirect 301 /en/about/standards.php TODO
  Redirect 301 /en/about/standards.php?lang=en TODO
  Redirect 301 /about/standards.php?lang=fr TODO

  Redirect 301 /en/about/data-access.php TODO
  Redirect 301 /en/about/data-access.php?lang=en TODO
  Redirect 301 /about/data-access.php?lang=fr TODO

  Redirect 301 /en/about/formats.php TODO
  Redirect 301 /en/about/formats.php?lang=en TODO
  Redirect 301 /about/formats.php?lang=fr TODO

  Redirect 301 /en/about/glossary.php TODO
  Redirect 301 /en/about/glossary.php?lang=en TODO
  Redirect 301 /about/glossary.php?lang=fr TODO

  Redirect 301 /en/about/faq.php TODO
  Redirect 301 /en/about/faq.php?lang=en TODO
  Redirect 301 /about/faq.php?lang=fr TODO
</IfModule>

# enable WAF indexing
<Directory /data/web/woudc.org/archive>
  Options Indexes FollowSymLinks
</Directory>

# provide a custom 404 page
ErrorDocument 404 TODO-404-page

# disable TRACE operations
TraceEnable off

# display README files on page indexes
ReadmeName README.txt

# enable auth on level 0 data
<Location "/archive/level-0/">
  AuthType Basic
  AuthName "level-0"
  AuthUserFile /data/web/woudc/http-accessfile
  AuthUserFile /web/woudc/.ht/htpasswd
  AuthGroupFile /web/woudc/.ht/htgroup
  Require group woudc-group
</Location>

# SPA fallback (enable persistent routing)
<IfModule mod_rewrite.c>
  RewriteEngine On
  RewriteBase /woudc-2.0/nightly/latest
  RewriteRule ^woudc-2.0/nightly/latest/index\.html$ - [L]
  RewriteCond %{REQUEST_FILENAME} !-f
  RewriteCond %{REQUEST_FILENAME} !-d
  RewriteRule . /woudc-2.0/nightly/latest/index.html [L]
</IfModule>
